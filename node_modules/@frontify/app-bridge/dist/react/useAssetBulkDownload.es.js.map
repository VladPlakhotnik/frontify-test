{"version":3,"file":"useAssetBulkDownload.es.js","sources":["../../src/react/useAssetBulkDownload.ts"],"sourcesContent":["/* (c) Copyright Frontify Ltd., all rights reserved. */\n\nimport { useRef, useState } from 'react';\nimport type { AppBridgeBlock } from '../AppBridgeBlock';\n\nexport enum AssetBulkDownloadState {\n    Init = 'init',\n    Started = 'started',\n    Pending = 'pending',\n    Ready = 'ready',\n    Error = 'error',\n}\n\nexport const useAssetBulkDownload = (appBridge: AppBridgeBlock) => {\n    const intervalId = useRef<number | null>(null);\n    const [status, setStatus] = useState<AssetBulkDownloadState>(AssetBulkDownloadState.Init);\n    const [downloadUrl, setDownloadUrl] = useState<Nullable<string>>(null);\n\n    const generateBulkDownload = async (settingIds?: string[]) => {\n        try {\n            setStatus(AssetBulkDownloadState.Started);\n\n            const { assetBulkDownloadToken } = await appBridge.api({\n                name: 'getAssetBulkDownloadToken',\n                payload: { settingIds, documentBlockId: appBridge.getBlockId() },\n            });\n\n            setDownloadUrl(null);\n            startDownload(assetBulkDownloadToken);\n        } catch (error) {\n            setStatus(AssetBulkDownloadState.Error);\n            console.error(error);\n        }\n    };\n\n    const startDownload = async (token: string) => {\n        try {\n            const download = await appBridge.getBulkDownloadByToken(token);\n\n            if (download.downloadUrl) {\n                setDownloadUrl(download.downloadUrl);\n                setStatus(AssetBulkDownloadState.Ready);\n            } else {\n                setStatus(AssetBulkDownloadState.Pending);\n                intervalId.current = listenForBulkDownloadReady(download.signature);\n            }\n        } catch (error) {\n            setStatus(AssetBulkDownloadState.Error);\n            console.error(error);\n        }\n    };\n\n    const listenForBulkDownloadReady = (signature: string) => {\n        return window.setInterval(() => {\n            (async () => {\n                try {\n                    const download = await appBridge.getBulkDownloadBySignature(signature);\n\n                    if (download.downloadUrl) {\n                        setStatus(AssetBulkDownloadState.Ready);\n                        setDownloadUrl(download.downloadUrl);\n                        intervalId.current && clearInterval(intervalId.current);\n                    }\n                } catch (error) {\n                    setStatus(AssetBulkDownloadState.Error);\n                    console.error(error);\n                    intervalId.current && clearInterval(intervalId.current);\n                }\n            })();\n        }, 2500);\n    };\n\n    return { generateBulkDownload, status, downloadUrl };\n};\n"],"names":["AssetBulkDownloadState","useAssetBulkDownload","appBridge","intervalId","useRef","status","setStatus","useState","downloadUrl","setDownloadUrl","generateBulkDownload","settingIds","assetBulkDownloadToken","startDownload","error","token","download","listenForBulkDownloadReady","signature"],"mappings":";AAKY,IAAAA,sBAAAA,OACRA,EAAA,OAAO,QACPA,EAAA,UAAU,WACVA,EAAA,UAAU,WACVA,EAAA,QAAQ,SACRA,EAAA,QAAQ,SALAA,IAAAA,KAAA,CAAA,CAAA;AAQC,MAAAC,IAAuB,CAACC,MAA8B;AACzD,QAAAC,IAAaC,EAAsB,IAAI,GACvC,CAACC,GAAQC,CAAS,IAAIC;AAAA,IAAiC;AAAA;AAAA,EAA2B,GAClF,CAACC,GAAaC,CAAc,IAAIF,EAA2B,IAAI,GAE/DG,IAAuB,OAAOC,MAA0B;AACtD,QAAA;AACA,MAAAL;AAAA,QAAU;AAAA;AAAA,MAA8B;AAExC,YAAM,EAAE,wBAAAM,EAAA,IAA2B,MAAMV,EAAU,IAAI;AAAA,QACnD,MAAM;AAAA,QACN,SAAS,EAAE,YAAAS,GAAY,iBAAiBT,EAAU,aAAa;AAAA,MAAA,CAClE;AAED,MAAAO,EAAe,IAAI,GACnBI,EAAcD,CAAsB;AAAA,aAC/BE,GAAO;AACZ,MAAAR;AAAA,QAAU;AAAA;AAAA,MAA4B,GACtC,QAAQ,MAAMQ,CAAK;AAAA,IACvB;AAAA,EAAA,GAGED,IAAgB,OAAOE,MAAkB;AACvC,QAAA;AACA,YAAMC,IAAW,MAAMd,EAAU,uBAAuBa,CAAK;AAE7D,MAAIC,EAAS,eACTP,EAAeO,EAAS,WAAW,GACnCV;AAAA,QAAU;AAAA;AAAA,MAA4B,MAEtCA;AAAA,QAAU;AAAA;AAAA,MAA8B,GAC7BH,EAAA,UAAUc,EAA2BD,EAAS,SAAS;AAAA,aAEjEF,GAAO;AACZ,MAAAR;AAAA,QAAU;AAAA;AAAA,MAA4B,GACtC,QAAQ,MAAMQ,CAAK;AAAA,IACvB;AAAA,EAAA,GAGEG,IAA6B,CAACC,MACzB,OAAO,YAAY,MAAM;AAC5B,KAAC,YAAY;AACL,UAAA;AACA,cAAMF,IAAW,MAAMd,EAAU,2BAA2BgB,CAAS;AAErE,QAAIF,EAAS,gBACTV;AAAA,UAAU;AAAA;AAAA,QAA4B,GACtCG,EAAeO,EAAS,WAAW,GACxBb,EAAA,WAAW,cAAcA,EAAW,OAAO;AAAA,eAErDW,GAAO;AACZ,QAAAR;AAAA,UAAU;AAAA;AAAA,QAA4B,GACtC,QAAQ,MAAMQ,CAAK,GACRX,EAAA,WAAW,cAAcA,EAAW,OAAO;AAAA,MAC1D;AAAA,IAAA;KAEL,IAAI;AAGJ,SAAA,EAAE,sBAAAO,GAAsB,QAAAL,GAAQ,aAAAG;AAC3C;"}